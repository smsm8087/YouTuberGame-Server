@page "/statistics"
@inject AdminAuthService AuthService
@inject AdminApiClient ApiClient
@inject NavigationManager Navigation

<PageTitle>í†µê³„</PageTitle>

@if (!AuthService.IsAuthenticated)
{
    <p>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤...</p>
    return;
}

<h1>ğŸ“ˆ í†µê³„</h1>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5>ê°€ì±  í†µê³„</h5>
            </div>
            <div class="card-body">
                @if (gachaStats == null)
                {
                    <p><em>ë°ì´í„° ë¡œë”© ì¤‘...</em></p>
                }
                else
                {
                    <p><strong>ì´ ê°€ì±  íšŸìˆ˜:</strong> @gachaStats.TotalDraws.ToString("N0")</p>

                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>ë“±ê¸‰</th>
                                <th>íšŸìˆ˜</th>
                                <th>ì‹¤ì œ í™•ë¥ </th>
                                <th>ê¸°ëŒ€ í™•ë¥ </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>C</td>
                                <td>@gachaStats.TotalCRarity</td>
                                <td>@gachaStats.ActualCRate.ToString("F2")%</td>
                                <td>50%</td>
                            </tr>
                            <tr>
                                <td>B</td>
                                <td>@gachaStats.TotalBRarity</td>
                                <td>@gachaStats.ActualBRate.ToString("F2")%</td>
                                <td>30%</td>
                            </tr>
                            <tr>
                                <td>A</td>
                                <td>@gachaStats.TotalARarity</td>
                                <td>@gachaStats.ActualARate.ToString("F2")%</td>
                                <td>15%</td>
                            </tr>
                            <tr>
                                <td>S</td>
                                <td>@gachaStats.TotalSRarity</td>
                                <td>@gachaStats.ActualSRate.ToString("F2")%</td>
                                <td>5%</td>
                            </tr>
                        </tbody>
                    </table>
                }
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5>ì½˜í…ì¸  í†µê³„</h5>
            </div>
            <div class="card-body">
                @if (contentStats == null)
                {
                    <p><em>ë°ì´í„° ë¡œë”© ì¤‘...</em></p>
                }
                else
                {
                    <p><strong>ì´ ì½˜í…ì¸ :</strong> @contentStats.TotalContents.ToString("N0")</p>
                    <p><strong>ì—…ë¡œë“œ ì™„ë£Œ:</strong> @contentStats.TotalUploaded.ToString("N0")</p>
                    <p><strong>í‰ê·  í’ˆì§ˆ:</strong> @contentStats.AverageQuality.ToString("F1")</p>
                    <p><strong>ì´ ì¡°íšŒìˆ˜:</strong> @contentStats.TotalViews.ToString("N0")</p>
                    <p><strong>ì´ ìˆ˜ìµ:</strong> @contentStats.TotalRevenue.ToString("N0") ê³¨ë“œ</p>

                    <h6 class="mt-3">ì¥ë¥´ë³„ ë¶„í¬</h6>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>ì¥ë¥´</th>
                                <th>ê°œìˆ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var genre in contentStats.GenreDistribution)
                            {
                                <tr>
                                    <td>@genre.Key</td>
                                    <td>@genre.Value</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
            </div>
        </div>
    </div>
</div>

@code {
    private GachaStatistics? gachaStats;
    private ContentStatistics? contentStats;

    protected override async Task OnInitializedAsync()
    {
        if (!AuthService.IsAuthenticated)
        {
            Navigation.NavigateTo("/login");
            return;
        }

        gachaStats = await ApiClient.GetGachaStatisticsAsync();
        contentStats = await ApiClient.GetContentStatisticsAsync();
    }
}
